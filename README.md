# 🤖 MegaETH Advanced Market Making Bot

一个基于 **MegaETH 测试网** 的高级做市机器人，通过 **Realtime API** 实现毫秒级交易执行。支持多钱包并行和SOCKS5代理，模拟真实分布式做市商环境。

## ⭐ 核心特性

- 🚀 **Realtime API集成** - 使用`realtime_sendRawTransaction`实现毫秒级交易确认
- 👥 **多钱包并行** - 支持无限钱包同时运行，模拟分布式做市环境
- 🌐 **SOCKS5代理支持** - 每个钱包独立配置带认证的SOCKS5代理
- 🎯 **差异化策略系统** - 8种交易策略随机分配，模拟真实多样化做市商
- 📊 **智能做市策略** - 多种操作类型：下单、撤单、修改订单、批量交易
- ⚡ **高频交易** - 420ms间隔，模拟真实做市商节奏
- 🎲 **策略随机化** - 每个钱包自动获得独特的交易行为模式
- 📈 **实时统计** - 成功率、延迟、操作分布等关键指标监控

## 🎯 差异化策略系统

### 🎲 8种交易策略
每个钱包启动时随机分配一种策略，模拟不同类型的做市商：

#### 基础策略
- **� 修Aggressive (激进)** - 撤单50% 调用30% 批量20% 修改25%
- **⚖️ Balanced (平衡)** - 撤单35% 调用50% 批量15% 修改20%  
- **🛡️ Conservative (保守)** - 撤单20% 调用60% 批量10% 修改15%

#### 专业策略
- **⚡ Scalper (超短线)** - 撤单70% 调用10% 批量5% 修改40%
- **🔄 Arbitrage (套利)** - 撤单30% 调用40% 批量25% 修改10%
- **📈 Momentum (趋势)** - 撤单25% 调用45% 批量30% 修改15%
- **🔀 Contrarian (逆向)** - 撤单40% 调用35% 批量10% 修改30%
- **😴 Passive (被动)** - 撤单15% 调用70% 批量8% 修改12%

### 操作类型说明
- **🔴 撤单操作** - 模拟订单撤销，使用不同价格层级(1-10 wei)
- **🔵 合约调用** - 调用Pinger合约的`poke()`函数
- **🟢 下单操作** - 模拟新订单提交
- **🔄 修改订单** - 先撤单再下单的组合操作
- **📦 批量交易** - 并行发送3笔交易，测试网络并发处理能力

### 👥 多钱包架构
- **无限钱包支持** - 通过 `WALLET{N}_PRIVATE_KEY` 配置任意数量钱包
- **策略自动分配** - 每个钱包随机获得独特的交易策略
- **独立代理配置** - 每个钱包可配置独立的SOCKS5代理
- **并行执行** - 所有钱包同时运行，互不干扰
- **差异化行为** - 不同策略的钱包表现出不同的交易模式
- **分组统计** - 每个钱包独立的成功率和操作统计
- **错误隔离** - 单个钱包错误不影响其他钱包运行

### 🌐 SOCKS5代理支持
- **带认证代理** - 支持用户名密码认证
- **格式**: `socks5://用户名:密码@代理服务器:端口`
- **直连模式** - 代理为空时自动使用直连
- **独立配置** - 每个钱包使用不同的代理IP

## 获取测试现网 ETH

👉 **水龙头地址**: https://testnet.megaeth.com/
👉 **浏览器**: https://www.megaexplorer.xyz/

## ⚙️ 环境配置

### 1️⃣ 安装依赖
```bash
npm install
```

### 2️⃣ 创建 .env
```bash
cp .env.example .env
```
根据文件内提示填入必要变量，支持多钱包多代理。

**策略配置**：
- **自动模式**（推荐）：不设置 `WALLET_STRATEGY`，系统自动随机分配
- **手动模式**：设置 `WALLET1_STRATEGY=aggressive` 等手动指定策略

### 3️⃣ 编译合约
```bash
npx hardhat compile
```

### 4️⃣ 部署合约
```bash
npx hardhat run scripts/deploy.js --network megaeth
```

## 🚀 启动做市机器人

```bash
node realtime.js
```

### 运行效果示例

**差异化策略多钱包模式：**
```
🤖 Advanced Market Making Bot Started
👥 Wallets: 3
🌐 Proxies: 2
📊 Strategies: scalper:1 arbitrage:1 passive:1
📈 Sample Strategy: Cancel=70% Call=10% Batch=5% Modify=40%
🌐 创建SOCKS5代理: socks5://***@proxy1.example.com:1080
💼 Wallet[0]: 0x70997964... direct 📊 scalper
💼 Wallet[1]: 0x3C44CdDd... via proxy1.example.com:1080 📊 arbitrage  
💼 Wallet[2]: 0x90F79bf6... via proxy2.example.com:1080 📊 passive

[MM W0] 🔴 cancel OID=0 price=1000 value=2wei      # 超短线：高撤单率
[MM W1] 📦 BATCH START OID=10000-10002             # 套利：高批量率
[MM W2] 🔵 poke OID=20000 price=1000               # 被动：高调用率
[MM W0] ✅ cancel OID=0 hash=0x84a76cbf... latency=586ms
[MM W1] ✅ batch[0] OID=10000 hash=0x3f7d8f1c...
[MM W2] ✅ poke OID=20000 hash=0x4c5c8e78... latency=301ms
```

## 🧠 智能合约功能

| 函数 | 说明 | 做市机器人用途 |
|------|------|----------------|
| `poke()` | 记录调用并统计gas消耗 | 50%概率调用，模拟合约交互 |
| `getStats(address)` | 查询地址的调用统计 | 监控机器人活跃度 |
| `getAllUsers()` | 返回所有交互用户 | 分析网络参与者 |
| `getTopUsers(n)` | 返回前N名活跃用户 | 排行榜功能 |

## 📈 性能指标

| 指标 | 数值 | 说明 |
|------|------|------|
| 交易频率 | ~420ms | 每次操作间隔 |
| 平均延迟 | 300-600ms | Realtime API响应时间 |
| 成功率 | >99% | 交易执行成功率 |
| 价格范围 | 990-1010wei | 动态价格发现区间 |
| 并发能力 | 3笔/批次 | 批量交易测试 |
| Gas效率 | 22k-200k | 根据操作类型优化 |

## 🎯 使用场景

- **压力测试** - 多钱包并发测试网络承载能力
- **做市模拟** - 模拟真实分布式做市商环境，8种策略覆盖不同交易风格
- **策略研究** - 观察不同策略在相同市场条件下的表现差异
- **IP分散** - 通过不同代理分散请求来源
- **风险分散** - 多钱包分散资金和操作风险
- **行为多样化** - 每个钱包表现出独特的交易模式，更真实模拟市场参与者

## 🏆 MegaETH权重等级

根据MegaETH参与行动手册，本项目达到：

| 权重等级 | 行为类型 | 本项目实现 |
|----------|----------|------------|
| ⭐⭐⭐⭐ (最高) | 部署/运行真实协议或Bot | ✅ 高级做市机器人 |
| ⭐⭐⭐ | 使用Realtime API进行流式交互 | ✅ realtime_sendRawTransaction |
| ⭐⭐ | 高频/稳定交互 + Gas消耗 | ✅ 420ms间隔 + 智能Gas策略 |